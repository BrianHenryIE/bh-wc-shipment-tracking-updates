<?php

namespace BrianHenryIE\WC_Shipment_Tracking_Updates\API\Trackers;

use BrianHenryIE\ColorLogger\ColorLogger;
use BrianHenryIE\WC_Shipment_Tracking_Updates\USPS\XML2Array;
use Exception;

class USPS_Tracking_Details_Unit_Test extends \Codeception\Test\Unit {

	public function test_error_response() {

		$this->markTestIncomplete( 'This happens when a tracking number is old (maybe over 60 days) it is no longer in the system' );

		$response = <<<'EOD'
<?xml version="1.0" encoding="UTF-8"?>
<TrackResponse><TrackInfo ID="9111116901111190111361"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090944178"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090972133"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090949715"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090944611"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090977916"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090977138"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090970313"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="LZ630057084US"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090976001"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090970917"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919084"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919060"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919053"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919404"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919930"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090919947"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090917424"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405510898275026916511"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090917776"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090917905"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9400116901141090911719"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9400116901141090932028"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo><TrackInfo ID="9405516901141090933844"><Error><Number>-2147219283</Number><Description>A status update is not yet available on your Priority Mail&lt;SUP>&amp;reg;&lt;/SUP> package. It will be available when the shipper provides an update or the package is delivered to USPS. Check back soon. Sign up for Informed Delivery&lt;SUP>&amp;reg;&lt;/SUP> to receive notifications for packages addressed to you.</Description><HelpFile/><HelpContext/></Error></TrackInfo></TrackResponse>
EOD;

		$response_array = XML2Array::createArray( $response );

		$logger    = new ColorLogger();
		$exception = null;
		try {
			$sut = new USPS_Tracking_Details( '9111116901111190111361', $response_array['TrackResponse']['TrackInfo'][0], $logger );
		} catch ( Exception $e ) {
			$exception = $e;
		}

		$this->assertNull( $exception, $exception->getMessage() );

	}


}
